<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_invoice_document_gold" inherit_id="account.report_invoice_document">
        <!-- Use gold layout (no header, A5) instead of company default -->
        <xpath expr="//t[@t-call='web.external_layout']" position="attributes">
            <attribute name="t-call">gold_pricing.external_layout_gold</attribute>
        </xpath>
        <!-- Hide partner (customer) address/name block - we only show customer in "Invoice to:" -->
        <xpath expr="//div[@name='no_shipping']" position="replace">
            <div name="no_shipping" class="offset-col-6 col-6"/>
        </xpath>
        <xpath expr="//div[@name='address_same_as_shipping']" position="replace">
            <div name="address_same_as_shipping" class="offset-col-6 col-6"/>
        </xpath>
        <xpath expr="//div[@name='address_not_same_as_shipping']" position="replace">
            <div name="address_not_same_as_shipping" class="col-6"/>
        </xpath>
        <!-- Hide shipping address block (avoid duplicate customer address) -->
        <xpath expr="//div[@name='shipping_address_block']" position="replace">
            <div name="shipping_address_block"/>
        </xpath>
        <!-- Invoice styles: hide header only, show footer, relaxed layout, section lines, consistent left alignment -->
        <xpath expr="(//div[contains(@class, 'row')])[1]" position="before">
            <style><![CDATA[
                body { font-size: 11px; margin: 0; padding: 0; }
                .o_standard_header, .o_background_header, .o_clean_header, .o_boxed_header,
                div[class*='external_layout'][class*='header'] { display: none !important; }
                .o_standard_footer, .o_clean_footer, .o_boxed_footer, .o_background_footer,
                div[class*='footer']:not([class*='header']) { display: block !important; visibility: visible !important; }
                .page.mb-4 { max-width: none; padding-left: 10mm; padding-right: 10mm; }
                .mt-5.clearfix { max-width: none; }
                .o_report_logo_space {
                    min-height: 20px; padding-bottom: 0.5rem; margin-bottom: 0.5rem;
                    border-bottom: 1px solid #e5e7eb;
                }
                div[name="invoice_to_block"] {
                    padding-bottom: 1rem; margin-bottom: 1rem;
                    border-bottom: 1px solid #e5e7eb;
                }
                table[name="invoice_line_table"] { margin-top: 0.25rem; }
                .o_invoice_to_block { padding: 0.5rem 0; }
                .o_invoice_to_label {
                    font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;
                    color: #6c757d; margin-bottom: 0.25rem; font-weight: 600;
                }
                .o_invoice_to_name {
                    font-size: 1rem; font-weight: 600; color: #212529; margin-bottom: 0.35rem;
                }
                .o_invoice_to_contact {
                    font-size: 0.875rem; color: #495057;
                }
                .o_invoice_to_contact .o_invoice_to_phone,
                .o_invoice_to_contact .o_invoice_to_mobile { font-weight: 500; }
            ]]></style>
            <div class="o_report_logo_space"/>
        </xpath>
        <!-- Invoice to: customer name on first row, phone/mobile on second row -->
        <xpath expr="//div[@id='informations']" position="replace">
            <div class="row mb-4" name="invoice_to_block">
                <div class="col-6 o_invoice_to_block">
                    <div class="o_invoice_to_label">Invoice to:</div>
                    <div class="o_invoice_to_name"><span t-field="o.partner_id.name"/></div>
                    <div class="o_invoice_to_contact">
                        <t t-if="o.partner_id.phone">
                            <span class="o_invoice_to_phone">Tel: <span t-field="o.partner_id.phone"/></span>
                        </t>
                        <t t-if="o.partner_id.phone and o.partner_id.mobile"> | </t>
                        <t t-if="o.partner_id.mobile">
                            <span class="o_invoice_to_mobile">Mobile: <span t-field="o.partner_id.mobile"/></span>
                        </t>
                    </div>
                </div>
                <div class="col-6 text-end">
                    <strong>Date:</strong>
                    <span t-field="o.invoice_date" t-options="{'format': 'dd-MMM-yy'}"/>
                </div>
            </div>
        </xpath>
        <!-- Add Purity and Weight columns to main table header (after Description) -->
        <xpath expr="//th[@name='th_description']" position="after">
            <th name="th_purity" class="text-end"><span>Purity</span></th>
            <th name="th_weight" class="text-end"><span>Weight (g)</span></th>
        </xpath>
        <!-- Remove Taxes column from header -->
        <xpath expr="//th[@name='th_taxes']" position="replace"/>
        <!-- Add Purity and Weight cells to each product line (after Description) -->
        <xpath expr="//td[@name='account_invoice_line_name']" position="after">
            <td name="td_purity" class="text-end">
                <span t-field="line.gold_purity"/>
            </td>
            <td name="td_weight" class="text-end">
                <span t-field="line.gold_weight_g"/>
            </td>
        </xpath>
        <!-- Remove Taxes cell and the t-set for taxes from product line -->
        <xpath expr="//td[@name='td_taxes']" position="replace"/>
        <xpath expr="//t[@t-set='taxes'][@t-value]" position="replace"/>
        <!-- Remove Payment Communication block (div containing p name="payment_communication") -->
        <xpath expr="//p[@name='payment_communication']/parent::div" position="replace"/>
    </template>
    <!-- Hide tax breakdown in company-currency block (when invoice currency != company currency) -->
    <template id="document_tax_totals_company_currency_gold" inherit_id="account.document_tax_totals_company_currency_template">
        <xpath expr="//div[contains(@class, 'totals_taxes_company_currency')]" position="replace">
            <div class="oe_structure"/>
        </xpath>
    </template>
</odoo>
