<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_invoice_document_gold" inherit_id="account.report_invoice_document">

        <!-- Force standard external layout so header/footer (and custom footer) always render. -->
        <xpath expr="//t[@t-call='web.external_layout']" position="attributes">
            <attribute name="t-call">web.external_layout_standard</attribute>
        </xpath>
        <!-- Layout expects company; set it before the layout runs (dispatcher normally does this). -->
        <xpath expr="//t[@t-call='web.external_layout_standard']/t[1]" position="before">
            <t t-set="company" t-value="o.company_id"/>
        </xpath>

        <!-- Complete header deletion -->
        <xpath expr="//div[contains(@class, 'row')]" position="replace" />

        <!-- Our custom doc title -->
        <xpath expr="//div[contains(@class, 'page') and contains(@class, 'mb-4')]/h2" position="replace">
            <h2>
                <center>
                    <span t-if="not proforma"></span>
                    <span t-else="">PROFORMA</span>
                    <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">Invoice</span>
                    <span t-elif="o.move_type == 'out_invoice' and o.state == 'draft'">Draft Invoice</span>
                    <span t-elif="o.move_type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
                    <span t-elif="o.move_type == 'out_refund' and o.state == 'posted'">Credit Note</span>
                    <span t-elif="o.move_type == 'out_refund' and o.state == 'draft'">Draft Credit Note</span>
                    <span t-elif="o.move_type == 'out_refund' and o.state == 'cancel'">Cancelled Credit Note</span>
                    <span t-elif="o.move_type == 'in_refund'">Vendor Credit Note</span>
                    <span t-elif="o.move_type == 'in_invoice'">Vendor Bill</span>
                    <span t-if="o.name != '/'" t-field="o.name">INV/2023/0001</span>    
                </center>
            </h2>
        </xpath>

        <!-- Our Custom Info Block -->
        <xpath expr="//div[@id='informations']" position="replace">
            <div class="row mb-4" name="invoice_to_block">
                <div class="col-6 o_invoice_to_block">
                    <div class="o_invoice_to_label">Invoice to:</div>
                    <div class="o_invoice_to_name"><span t-field="o.partner_id.name"/></div>
                    <div class="o_invoice_to_contact">
                        <t t-if="o.partner_id.phone">
                            <span class="o_invoice_to_phone">Tel: <span t-field="o.partner_id.phone"/></span>
                        </t>
                        <t t-if="o.partner_id.phone and o.partner_id.mobile"> | </t>
                        <t t-if="o.partner_id.mobile">
                            <span class="o_invoice_to_mobile">Mobile: <span t-field="o.partner_id.mobile"/></span>
                        </t>
                    </div>
                </div>
                <div class="col-6 text-end">
                    <strong>Date:</strong>
                    <span t-field="o.invoice_date" t-options="{'format': 'dd-MMM-yy'}"/>
                </div>
            </div>
        </xpath>

        <!-- Gold invoice: Purity and Weight columns, no Taxes column, no payment communication. Layout and paper format use company default. -->
        <xpath expr="//th[@name='th_description']" position="after">
            <th name="th_purity" class="text-end"><span>Purity</span></th>
            <th name="th_weight" class="text-end"><span>Weight (g)</span></th>
        </xpath>

        <!-- Our custom payment block -->
        <xpath expr="//div[contains(@class, 'ms-auto')]" position="replace">
            <div class="ms-auto">
                <table class="table table-sm table-borderless avoid-page-break-inside">
                    <!-- Custom Total Amount -->
                    <tr class="border-black fw-bold">
                        <td>Total Amount</td>
                        <td class="text-end">
                            <span t-field="o.amount_total"
                                t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                        </td>
                    </tr>
                </table>
            </div>
        </xpath>

        <!-- Add Purity and Weight cells to each product line (after Description) -->
        <xpath expr="//td[@name='account_invoice_line_name']" position="after">
            <td name="td_purity" class="text-end">
                <span t-field="line.gold_purity"/>
            </td>
            <td name="td_weight" class="text-end">
                <span t-field="line.gold_weight_g"/>
            </td>
        </xpath>

        <!-- Remove Taxes column from header -->
        <xpath expr="//th[@name='th_taxes']" position="replace"/>

        <!-- Remove Taxes cell and the t-set for taxes from product line -->
        <xpath expr="//td[@name='td_taxes']" position="replace"/>
        <xpath expr="//t[@t-set='taxes'][@t-value]" position="replace"/>
        <!-- Remove Payment Communication block (div containing p name="payment_communication") -->
        <xpath expr="//p[@name='payment_communication']/parent::div" position="replace"/>
    </template>
</odoo>
