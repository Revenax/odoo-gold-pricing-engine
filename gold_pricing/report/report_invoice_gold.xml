<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_invoice_document_gold" inherit_id="account.report_invoice_document">
        <!-- Hide partner (customer) address/name block - we only show customer in "Invoice to:" -->
        <xpath expr="//div[@name='no_shipping']" position="replace">
            <div name="no_shipping" class="offset-col-6 col-6"/>
        </xpath>
        <xpath expr="//div[@name='address_same_as_shipping']" position="replace">
            <div name="address_same_as_shipping" class="offset-col-6 col-6"/>
        </xpath>
        <xpath expr="//div[@name='address_not_same_as_shipping']" position="replace">
            <div name="address_not_same_as_shipping" class="col-6"/>
        </xpath>
        <!-- Hide shipping address block (avoid duplicate customer address) -->
        <xpath expr="//div[@name='shipping_address_block']" position="replace">
            <div name="shipping_address_block"/>
        </xpath>
        <!-- Hide external layout header; add top spacing for logo -->
        <xpath expr="(//div[contains(@class, 'row')])[1]" position="before">
            <style><![CDATA[
                .o_standard_header, .o_background_header, .o_clean_header, .o_boxed_header,
                .o_report_layout_standard > div:first-child:not(.page),
                div[class*='external_layout'][class*='header'] { display: none !important; }
                .o_invoice_to_block { padding: 0.5rem 0; }
                .o_invoice_to_label {
                    font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;
                    color: #6c757d; margin-bottom: 0.25rem; font-weight: 600;
                }
                .o_invoice_to_name {
                    font-size: 1rem; font-weight: 600; color: #212529; margin-bottom: 0.35rem;
                }
                .o_invoice_to_contact {
                    font-size: 0.875rem; color: #495057;
                }
                .o_invoice_to_contact .o_invoice_to_phone,
                .o_invoice_to_contact .o_invoice_to_mobile { font-weight: 500; }
            ]]></style>
            <div style="min-height: 20px;" class="o_report_logo_space"/>
        </xpath>
        <!-- Invoice to: customer name on first row, phone/mobile on second row -->
        <xpath expr="//div[@id='informations']" position="replace">
            <div class="row mb-4" name="invoice_to_block">
                <div class="col-6 o_invoice_to_block">
                    <div class="o_invoice_to_label">Invoice to:</div>
                    <div class="o_invoice_to_name"><span t-field="o.partner_id.name"/></div>
                    <div class="o_invoice_to_contact">
                        <t t-if="o.partner_id.phone">
                            <span class="o_invoice_to_phone">Tel: <span t-field="o.partner_id.phone"/></span>
                        </t>
                        <t t-if="o.partner_id.phone and o.partner_id.mobile"> | </t>
                        <t t-if="o.partner_id.mobile">
                            <span class="o_invoice_to_mobile">Mobile: <span t-field="o.partner_id.mobile"/></span>
                        </t>
                    </div>
                </div>
                <div class="col-6 text-end">
                    <strong>Date:</strong>
                    <span t-field="o.invoice_date" t-options="{'format': 'dd-MMM-yy'}"/>
                </div>
            </div>
        </xpath>
        <!-- Add Purity and Weight columns to main table header (after Description) -->
        <xpath expr="//th[@name='th_description']" position="after">
            <th name="th_purity" class="text-end"><span>Purity</span></th>
            <th name="th_weight" class="text-end"><span>Weight (g)</span></th>
        </xpath>
        <!-- Remove Taxes column from header -->
        <xpath expr="//th[@name='th_taxes']" position="replace"/>
        <!-- Add Purity and Weight cells to each product line (after Description) -->
        <xpath expr="//td[@name='account_invoice_line_name']" position="after">
            <td name="td_purity" class="text-end">
                <span t-field="line.gold_purity"/>
            </td>
            <td name="td_weight" class="text-end">
                <span t-field="line.gold_weight_g"/>
            </td>
        </xpath>
        <!-- Remove Taxes cell and the t-set for taxes from product line -->
        <xpath expr="//td[@name='td_taxes']" position="replace"/>
        <xpath expr="//t[@t-set='taxes'][@t-value]" position="replace"/>
        <!-- Replace full tax totals block with only Total row (tax_totals already set above) -->
        <xpath expr="//t[@t-call='account.document_tax_totals']" position="replace">
            <tr class="border-black o_total">
                <td><strong>Total</strong></td>
                <td class="text-end">
                    <span t-out="tax_totals.get('formatted_amount_total')"/>
                </td>
            </tr>
        </xpath>
        <!-- Page container: flex column so footer can sit at bottom -->
        <xpath expr="//div[contains(@class, 'page') and contains(@class, 'mb-4')]" position="attributes">
            <attribute name="style">min-height: 88vh; display: flex; flex-direction: column;</attribute>
        </xpath>
        <!-- Spacer to push footer to bottom of page -->
        <xpath expr="//div[@id='payment_term']" position="after">
            <div style="min-height: 30vh; flex: 1 1 auto;" class="o_report_footer_spacer"/>
        </xpath>
        <!-- Footer: company phone, address, email, website (at bottom) -->
        <xpath expr="//div[@id='payment_term']" position="after">
            <div class="mt-4 pt-3 border-top" style="border-top: 1px solid #dee2e6 !important;">
                <div class="row text-center small">
                    <div class="col-4">
                        <t t-if="o.company_id.phone">
                            <span t-field="o.company_id.phone"/>
                        </t>
                    </div>
                    <div class="col-4">
                        <t t-if="o.company_id.street or o.company_id.city">
                            <span t-field="o.company_id.street"/>
                            <t t-if="o.company_id.street and o.company_id.city">, </t>
                            <span t-field="o.company_id.city"/>
                            <t t-if="o.company_id.country_id">, <span t-field="o.company_id.country_id.name"/></t>
                        </t>
                    </div>
                    <div class="col-4">
                        <t t-if="o.company_id.email">
                            <span t-field="o.company_id.email"/>
                        </t>
                        <t t-if="o.company_id.email and o.company_id.website"> | </t>
                        <t t-if="o.company_id.website">
                            <span t-field="o.company_id.website"/>
                        </t>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
    <!-- Hide tax breakdown in company-currency block (when invoice currency != company currency) -->
    <template id="document_tax_totals_company_currency_gold" inherit_id="account.document_tax_totals_company_currency_template">
        <xpath expr="//div[contains(@class, 'totals_taxes_company_currency')]" position="replace">
            <div class="oe_structure"/>
        </xpath>
    </template>
</odoo>
