<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        Extend invoice line views to expose gold-specific fields on all invoice lines.
        This allows manual entry of purity and weight for both inventory and
        unregistered gold items. Reporting already uses these fields via the
        gold invoice report template.
    -->

    <!-- Invoice line tree (list) view: add Purity and Weight columns.
         optional="show" so columns are visible by default in list/editable tree.
         priority 101 so this inheritance applies after base (100) and columns show. -->
    <record id="view_move_line_tree_gold_pricing" model="ir.ui.view">
        <field name="name">account.move.line.tree.gold.pricing</field>
        <field name="model">account.move.line</field>
        <field name="inherit_id" ref="account.view_move_line_tree"/>
        <field name="priority" eval="101"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="gold_purity" optional="show"/>
                <field name="gold_weight_g" optional="show"/>
            </xpath>
        </field>
    </record>

    <!-- Invoice line form view: add Purity and Weight fields -->
    <record id="view_move_line_form_gold_pricing" model="ir.ui.view">
        <field name="name">account.move.line.form.gold.pricing</field>
        <field name="model">account.move.line</field>
        <field name="inherit_id" ref="account.view_move_line_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="gold_purity"/>
                <field name="gold_weight_g"/>
            </xpath>
        </field>
    </record>

    <!-- Invoice form: add Purity and Weight to the invoice line list on the move form.
         In Odoo 17 the form may use an inline tree for invoice_line_ids; this xpath
         adds our columns there so they are visible when editing an invoice. -->
    <record id="view_move_form_gold_pricing" model="ir.ui.view">
        <field name="name">account.move.form.gold.pricing</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='quantity']" position="before">
                <field name="gold_purity"/>
                <field name="gold_weight_g"/>
            </xpath>
        </field>
    </record>

</odoo>

